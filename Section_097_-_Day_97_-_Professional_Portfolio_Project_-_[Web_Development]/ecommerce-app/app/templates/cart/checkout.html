{% extends "base.html" %}

{% block title %}Checkout - Art Ecom{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto glass-card p-8 fade-in">
    <h1 class="text-4xl font-light mb-6">Checkout</h1>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
            <h2 class="text-2xl mb-4">Order Summary</h2>
            <div class="space-y-2">
                {% for item in items %}
                <div class="flex justify-between">
                    <span>{{ item.name }} x {{ item.quantity }}</span>
                    <span>${{ item.subtotal }}</span>
                </div>
                {% endfor %}
                <div class="border-t border-white/20 pt-4 font-bold text-xl flex justify-between">
                    <span>Total</span>
                    <span>${{ total }}</span>
                </div>
            </div>
        </div>
        <div>
            <h2 class="text-2xl mb-4">Payment</h2>
            <button id="rzp-button" class="btn-primary">Pay with Razorpay</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    document.getElementById('rzp-button').onclick = function(e) {
        var options = {
            key: "{{ key_id }}",
            amount: "{{ order.amount }}",
            currency: "{{ order.currency }}",
            name: "Art Ecom",
            description: "Order payment",
            order_id: "{{ order.id }}",
            handler: function(response) {
                var form = document.createElement('form');
                form.method = 'POST';
                form.action = '{{ url_for("payment.payment_success") }}';
                for (var key in response) {
                    if (response.hasOwnProperty(key)) {
                        var input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = response[key];
                        form.appendChild(input);
                    }
                }
                document.body.appendChild(form);
                form.submit();
            },
            modal: {
                ondismiss: function() {
                    alert('Payment cancelled');
                }
            }
        };
        var rzp = new Razorpay(options);
        rzp.open();
        e.preventDefault();
    };
</script>
{% endblock %}