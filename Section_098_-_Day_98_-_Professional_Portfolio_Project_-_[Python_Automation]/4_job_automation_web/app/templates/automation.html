{% extends "base.html" %}
{% block content %}
<h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem;">Automation Control</h1>

<div class="card">
    <div class="card-body">
        <div class="flex justify-between items-center mb-4">
            <span style="font-size: 1.125rem; font-weight: 500;">Status:
                {% if running %}
                <span class="alert-success" style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.875rem; margin-left: 0.5rem;">Running</span>
                {% else %}
                <span class="alert-secondary" style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.875rem; margin-left: 0.5rem; background-color: #2d2d2d;">Stopped</span>
                {% endif %}
            </span>
            <span class="text-muted">Interval: <strong>{{ interval }} seconds</strong></span>
        </div>

        <p class="text-muted mb-4">The automation engine runs in the background at the set interval. Each cycle:</p>
        <ul class="mb-4" style="padding-left: 1.5rem;">
            <li>Reads all rows from your input data.</li>
            <li>If web automation is enabled, it fills the configured web form for each row.</li>
            <li>Generates a summary report and saves it.</li>
            <li>If email is enabled, sends the report.</li>
        </ul>

        <div class="flex gap-3">
            <button id="startBtn" class="btn btn-success" {% if running %}disabled{% endif %}>Start</button>
            <button id="stopBtn" class="btn btn-danger" {% if not running %}disabled{% endif %}>Stop</button>
            <button id="runOnceBtn" class="btn btn-primary">Run Once Now</button>
        </div>
    </div>
</div>

<script>
    document.getElementById('startBtn').addEventListener('click', function() {
        fetch('/automation/start', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'started') location.reload();
            });
    });
    document.getElementById('stopBtn').addEventListener('click', function() {
        fetch('/automation/stop', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'stopped') location.reload();
            });
    });
    document.getElementById('runOnceBtn').addEventListener('click', function() {
        fetch('/automation/run_once', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                alert('Automation triggered in background.');
            });
    });
</script>
{% endblock %}